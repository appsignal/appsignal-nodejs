# DO NOT EDIT
# This is a generated file by the `rake build_matrix:semaphore:generate` task.
# See `build_matrix.yml` for the build matrix.
# Generate this file with `rake build_matrix:semaphore:generate`.
---
version: v1.0
name: AppSignal for Node.js
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804
auto_cancel:
  running:
    when: branch != 'main' AND branch != 'develop'
global_job_config:
  env_vars:
  - name: RUNNING_IN_CI
    value: 'true'
  - name: NODE_ENV
    value: test
  - name: _PACKAGES_CACHE
    value: v1
  prologue:
    commands:
    - checkout
    - '[ -n "$NODE_VERSION" ] && sem-version node $NODE_VERSION || echo Skipping Node.js
      install'
    - script/setup
    - source ~/.bashrc
blocks:
- name: Validation
  dependencies: []
  task:
    jobs:
    - name: Validate CI setup
      commands:
      - rake build_matrix:semaphore:validate
- name: Linters
  dependencies: []
  task:
    jobs:
    - name: Git Lint (Lintje)
      env_vars:
      - name: LINTJE_VERSION
        value: 0.3.0
      commands:
      - script/install_lintje
      - "$HOME/bin/lintje $SEMAPHORE_GIT_COMMIT_RANGE"
- name: Node.js 16 - Build
  dependencies:
  - Validation
  task:
    env_vars:
    - name: NODE_VERSION
      value: '16'
    prologue:
      commands:
      - sem-version c 8
      - cache restore
      - mono bootstrap --ci
      - cache store
    jobs:
    - name: Build
      commands:
      - mono build
      - mono run --package @appsignal/nodejs-ext -- npm run build:ext
      - cache store $_PACKAGES_CACHE-packages-$SEMAPHORE_GIT_SHA-v$NODE_VERSION packages
      - cache store $_PACKAGES_CACHE-install-report-$SEMAPHORE_GIT_SHA-v$NODE_VERSION
        /tmp/appsignal-*-install.report
- name: Node.js 16 - Tests
  dependencies:
  - Node.js 16 - Build
  task:
    env_vars:
    - name: NODE_VERSION
      value: '16'
    prologue:
      commands:
      - sem-version c 8
      - cache restore
      - cache restore $_PACKAGES_CACHE-packages-$SEMAPHORE_GIT_SHA-v$NODE_VERSION
      - cache restore $_PACKAGES_CACHE-install-report-$SEMAPHORE_GIT_SHA-v$NODE_VERSION
      - mono bootstrap --ci
    jobs:
    - name: "@appsignal/nodejs - nodejs"
      commands:
      - mono test --package=@appsignal/nodejs
    - name: "@appsignal/nodejs - nodejs - diagnose"
      commands:
      - git submodule init
      - git submodule update
      - LANGUAGE=nodejs test/integration/diagnose/bin/test
    - name: "@appsignal/nodejs-ext - nodejs-ext"
      commands:
      - mono test --package=@appsignal/nodejs-ext
      - mono run --package @appsignal/nodejs-ext -- npm run test:failure
    - name: "@appsignal/apollo-server - apollo-server@latest"
      commands:
      - npm install apollo-server-plugin-base@latest --save-dev
      - mono test --package=@appsignal/apollo-server
    - name: "@appsignal/apollo-server - apollo-server@latest - integrations"
      commands:
      - npm install apollo-server-plugin-base@latest --save-dev
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle install
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle exec rspec packages/apollo-server/test
    - name: "@appsignal/apollo-server - apollo-server@0.13.0"
      commands:
      - npm install apollo-server-plugin-base@0.13.0 --save-dev
      - mono test --package=@appsignal/apollo-server
    - name: "@appsignal/apollo-server - apollo-server@0.13.0 - integrations"
      commands:
      - npm install apollo-server-plugin-base@0.13.0 --save-dev
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle install
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle exec rspec packages/apollo-server/test
    - name: "@appsignal/apollo-server - apollo-server@0.12.0"
      commands:
      - npm install apollo-server-plugin-base@0.12.0 --save-dev
      - mono test --package=@appsignal/apollo-server
    - name: "@appsignal/apollo-server - apollo-server@0.12.0 - integrations"
      commands:
      - npm install apollo-server-plugin-base@0.12.0 --save-dev
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle install
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle exec rspec packages/apollo-server/test
    - name: "@appsignal/apollo-server - apollo-server@0.11.0"
      commands:
      - npm install apollo-server-plugin-base@0.11.0 --save-dev
      - mono test --package=@appsignal/apollo-server
    - name: "@appsignal/apollo-server - apollo-server@0.11.0 - integrations"
      commands:
      - npm install apollo-server-plugin-base@0.11.0 --save-dev
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle install
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle exec rspec packages/apollo-server/test
    - name: "@appsignal/nextjs - next.js@latest - integrations"
      commands:
      - npm install next@latest react@latest react-dom@latest --save-dev
      - BUNDLE_GEMFILE=packages/nextjs/test/Gemfile bundle install
      - BUNDLE_GEMFILE=packages/nextjs/test/Gemfile bundle exec rspec packages/nextjs/test
    - name: "@appsignal/nextjs - next.js@11.0.1 - integrations"
      commands:
      - npm install next@11.0.1 react@17.0.2 react-dom@17.0.2 --save-dev
      - BUNDLE_GEMFILE=packages/nextjs/test/Gemfile bundle install
      - BUNDLE_GEMFILE=packages/nextjs/test/Gemfile bundle exec rspec packages/nextjs/test
    - name: "@appsignal/nextjs - next.js@10.2.3 - integrations"
      commands:
      - npm install next@10.2.3 react@16.14.0 react-dom@16.14.0 --save-dev
      - BUNDLE_GEMFILE=packages/nextjs/test/Gemfile bundle install
      - BUNDLE_GEMFILE=packages/nextjs/test/Gemfile bundle exec rspec packages/nextjs/test
- name: Node.js 15 - Build
  dependencies:
  - Validation
  task:
    env_vars:
    - name: NODE_VERSION
      value: '15'
    prologue:
      commands:
      - cache restore
      - mono bootstrap --ci
      - cache store
    jobs:
    - name: Build
      commands:
      - mono build
      - mono run --package @appsignal/nodejs-ext -- npm run build:ext
      - cache store $_PACKAGES_CACHE-packages-$SEMAPHORE_GIT_SHA-v$NODE_VERSION packages
      - cache store $_PACKAGES_CACHE-install-report-$SEMAPHORE_GIT_SHA-v$NODE_VERSION
        /tmp/appsignal-*-install.report
- name: Node.js 15 - Tests
  dependencies:
  - Node.js 15 - Build
  task:
    env_vars:
    - name: NODE_VERSION
      value: '15'
    prologue:
      commands:
      - cache restore
      - cache restore $_PACKAGES_CACHE-packages-$SEMAPHORE_GIT_SHA-v$NODE_VERSION
      - cache restore $_PACKAGES_CACHE-install-report-$SEMAPHORE_GIT_SHA-v$NODE_VERSION
      - mono bootstrap --ci
    jobs:
    - name: "@appsignal/nodejs - nodejs"
      commands:
      - mono test --package=@appsignal/nodejs
    - name: "@appsignal/nodejs - nodejs - diagnose"
      commands:
      - git submodule init
      - git submodule update
      - LANGUAGE=nodejs test/integration/diagnose/bin/test
    - name: "@appsignal/nodejs-ext - nodejs-ext"
      commands:
      - mono test --package=@appsignal/nodejs-ext
      - mono run --package @appsignal/nodejs-ext -- npm run test:failure
    - name: "@appsignal/apollo-server - apollo-server@latest"
      commands:
      - npm install apollo-server-plugin-base@latest --save-dev
      - mono test --package=@appsignal/apollo-server
    - name: "@appsignal/apollo-server - apollo-server@latest - integrations"
      commands:
      - npm install apollo-server-plugin-base@latest --save-dev
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle install
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle exec rspec packages/apollo-server/test
    - name: "@appsignal/apollo-server - apollo-server@0.13.0"
      commands:
      - npm install apollo-server-plugin-base@0.13.0 --save-dev
      - mono test --package=@appsignal/apollo-server
    - name: "@appsignal/apollo-server - apollo-server@0.13.0 - integrations"
      commands:
      - npm install apollo-server-plugin-base@0.13.0 --save-dev
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle install
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle exec rspec packages/apollo-server/test
    - name: "@appsignal/apollo-server - apollo-server@0.12.0"
      commands:
      - npm install apollo-server-plugin-base@0.12.0 --save-dev
      - mono test --package=@appsignal/apollo-server
    - name: "@appsignal/apollo-server - apollo-server@0.12.0 - integrations"
      commands:
      - npm install apollo-server-plugin-base@0.12.0 --save-dev
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle install
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle exec rspec packages/apollo-server/test
    - name: "@appsignal/apollo-server - apollo-server@0.11.0"
      commands:
      - npm install apollo-server-plugin-base@0.11.0 --save-dev
      - mono test --package=@appsignal/apollo-server
    - name: "@appsignal/apollo-server - apollo-server@0.11.0 - integrations"
      commands:
      - npm install apollo-server-plugin-base@0.11.0 --save-dev
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle install
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle exec rspec packages/apollo-server/test
    - name: "@appsignal/nextjs - next.js@latest - integrations"
      commands:
      - npm install next@latest react@latest react-dom@latest --save-dev
      - BUNDLE_GEMFILE=packages/nextjs/test/Gemfile bundle install
      - BUNDLE_GEMFILE=packages/nextjs/test/Gemfile bundle exec rspec packages/nextjs/test
    - name: "@appsignal/nextjs - next.js@11.0.1 - integrations"
      commands:
      - npm install next@11.0.1 react@17.0.2 react-dom@17.0.2 --save-dev
      - BUNDLE_GEMFILE=packages/nextjs/test/Gemfile bundle install
      - BUNDLE_GEMFILE=packages/nextjs/test/Gemfile bundle exec rspec packages/nextjs/test
    - name: "@appsignal/nextjs - next.js@10.2.3 - integrations"
      commands:
      - npm install next@10.2.3 react@16.14.0 react-dom@16.14.0 --save-dev
      - BUNDLE_GEMFILE=packages/nextjs/test/Gemfile bundle install
      - BUNDLE_GEMFILE=packages/nextjs/test/Gemfile bundle exec rspec packages/nextjs/test
- name: Node.js 14 - Build
  dependencies:
  - Validation
  task:
    env_vars:
    - name: NODE_VERSION
      value: '14'
    prologue:
      commands:
      - cache restore
      - mono bootstrap --ci
      - cache store
    jobs:
    - name: Build
      commands:
      - mono build
      - mono run --package @appsignal/nodejs-ext -- npm run build:ext
      - cache store $_PACKAGES_CACHE-packages-$SEMAPHORE_GIT_SHA-v$NODE_VERSION packages
      - cache store $_PACKAGES_CACHE-install-report-$SEMAPHORE_GIT_SHA-v$NODE_VERSION
        /tmp/appsignal-*-install.report
- name: Node.js 14 - Tests
  dependencies:
  - Node.js 14 - Build
  task:
    env_vars:
    - name: NODE_VERSION
      value: '14'
    prologue:
      commands:
      - cache restore
      - cache restore $_PACKAGES_CACHE-packages-$SEMAPHORE_GIT_SHA-v$NODE_VERSION
      - cache restore $_PACKAGES_CACHE-install-report-$SEMAPHORE_GIT_SHA-v$NODE_VERSION
      - mono bootstrap --ci
    jobs:
    - name: "@appsignal/nodejs - nodejs"
      commands:
      - mono test --package=@appsignal/nodejs
    - name: "@appsignal/nodejs - nodejs - diagnose"
      commands:
      - git submodule init
      - git submodule update
      - LANGUAGE=nodejs test/integration/diagnose/bin/test
    - name: "@appsignal/nodejs-ext - nodejs-ext"
      commands:
      - mono test --package=@appsignal/nodejs-ext
      - mono run --package @appsignal/nodejs-ext -- npm run test:failure
    - name: "@appsignal/apollo-server - apollo-server@latest"
      commands:
      - npm install apollo-server-plugin-base@latest --save-dev
      - mono test --package=@appsignal/apollo-server
    - name: "@appsignal/apollo-server - apollo-server@latest - integrations"
      commands:
      - npm install apollo-server-plugin-base@latest --save-dev
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle install
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle exec rspec packages/apollo-server/test
    - name: "@appsignal/apollo-server - apollo-server@0.13.0"
      commands:
      - npm install apollo-server-plugin-base@0.13.0 --save-dev
      - mono test --package=@appsignal/apollo-server
    - name: "@appsignal/apollo-server - apollo-server@0.13.0 - integrations"
      commands:
      - npm install apollo-server-plugin-base@0.13.0 --save-dev
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle install
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle exec rspec packages/apollo-server/test
    - name: "@appsignal/apollo-server - apollo-server@0.12.0"
      commands:
      - npm install apollo-server-plugin-base@0.12.0 --save-dev
      - mono test --package=@appsignal/apollo-server
    - name: "@appsignal/apollo-server - apollo-server@0.12.0 - integrations"
      commands:
      - npm install apollo-server-plugin-base@0.12.0 --save-dev
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle install
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle exec rspec packages/apollo-server/test
    - name: "@appsignal/apollo-server - apollo-server@0.11.0"
      commands:
      - npm install apollo-server-plugin-base@0.11.0 --save-dev
      - mono test --package=@appsignal/apollo-server
    - name: "@appsignal/apollo-server - apollo-server@0.11.0 - integrations"
      commands:
      - npm install apollo-server-plugin-base@0.11.0 --save-dev
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle install
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle exec rspec packages/apollo-server/test
    - name: "@appsignal/nextjs - next.js@latest - integrations"
      commands:
      - npm install next@latest react@latest react-dom@latest --save-dev
      - BUNDLE_GEMFILE=packages/nextjs/test/Gemfile bundle install
      - BUNDLE_GEMFILE=packages/nextjs/test/Gemfile bundle exec rspec packages/nextjs/test
    - name: "@appsignal/nextjs - next.js@11.0.1 - integrations"
      commands:
      - npm install next@11.0.1 react@17.0.2 react-dom@17.0.2 --save-dev
      - BUNDLE_GEMFILE=packages/nextjs/test/Gemfile bundle install
      - BUNDLE_GEMFILE=packages/nextjs/test/Gemfile bundle exec rspec packages/nextjs/test
    - name: "@appsignal/nextjs - next.js@10.2.3 - integrations"
      commands:
      - npm install next@10.2.3 react@16.14.0 react-dom@16.14.0 --save-dev
      - BUNDLE_GEMFILE=packages/nextjs/test/Gemfile bundle install
      - BUNDLE_GEMFILE=packages/nextjs/test/Gemfile bundle exec rspec packages/nextjs/test
- name: Node.js 13 - Build
  dependencies:
  - Validation
  task:
    env_vars:
    - name: NODE_VERSION
      value: '13'
    prologue:
      commands:
      - cache restore
      - mono bootstrap --ci
      - cache store
    jobs:
    - name: Build
      commands:
      - mono build
      - mono run --package @appsignal/nodejs-ext -- npm run build:ext
      - cache store $_PACKAGES_CACHE-packages-$SEMAPHORE_GIT_SHA-v$NODE_VERSION packages
      - cache store $_PACKAGES_CACHE-install-report-$SEMAPHORE_GIT_SHA-v$NODE_VERSION
        /tmp/appsignal-*-install.report
- name: Node.js 13 - Tests
  dependencies:
  - Node.js 13 - Build
  task:
    env_vars:
    - name: NODE_VERSION
      value: '13'
    prologue:
      commands:
      - cache restore
      - cache restore $_PACKAGES_CACHE-packages-$SEMAPHORE_GIT_SHA-v$NODE_VERSION
      - cache restore $_PACKAGES_CACHE-install-report-$SEMAPHORE_GIT_SHA-v$NODE_VERSION
      - mono bootstrap --ci
    jobs:
    - name: "@appsignal/nodejs - nodejs"
      commands:
      - mono test --package=@appsignal/nodejs
    - name: "@appsignal/nodejs - nodejs - diagnose"
      commands:
      - git submodule init
      - git submodule update
      - LANGUAGE=nodejs test/integration/diagnose/bin/test
    - name: "@appsignal/nodejs-ext - nodejs-ext"
      commands:
      - mono test --package=@appsignal/nodejs-ext
      - mono run --package @appsignal/nodejs-ext -- npm run test:failure
    - name: "@appsignal/apollo-server - apollo-server@latest"
      commands:
      - npm install apollo-server-plugin-base@latest --save-dev
      - mono test --package=@appsignal/apollo-server
    - name: "@appsignal/apollo-server - apollo-server@latest - integrations"
      commands:
      - npm install apollo-server-plugin-base@latest --save-dev
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle install
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle exec rspec packages/apollo-server/test
    - name: "@appsignal/apollo-server - apollo-server@0.13.0"
      commands:
      - npm install apollo-server-plugin-base@0.13.0 --save-dev
      - mono test --package=@appsignal/apollo-server
    - name: "@appsignal/apollo-server - apollo-server@0.13.0 - integrations"
      commands:
      - npm install apollo-server-plugin-base@0.13.0 --save-dev
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle install
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle exec rspec packages/apollo-server/test
    - name: "@appsignal/apollo-server - apollo-server@0.12.0"
      commands:
      - npm install apollo-server-plugin-base@0.12.0 --save-dev
      - mono test --package=@appsignal/apollo-server
    - name: "@appsignal/apollo-server - apollo-server@0.12.0 - integrations"
      commands:
      - npm install apollo-server-plugin-base@0.12.0 --save-dev
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle install
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle exec rspec packages/apollo-server/test
    - name: "@appsignal/apollo-server - apollo-server@0.11.0"
      commands:
      - npm install apollo-server-plugin-base@0.11.0 --save-dev
      - mono test --package=@appsignal/apollo-server
    - name: "@appsignal/apollo-server - apollo-server@0.11.0 - integrations"
      commands:
      - npm install apollo-server-plugin-base@0.11.0 --save-dev
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle install
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle exec rspec packages/apollo-server/test
    - name: "@appsignal/nextjs - next.js@latest - integrations"
      commands:
      - npm install next@latest react@latest react-dom@latest --save-dev
      - BUNDLE_GEMFILE=packages/nextjs/test/Gemfile bundle install
      - BUNDLE_GEMFILE=packages/nextjs/test/Gemfile bundle exec rspec packages/nextjs/test
    - name: "@appsignal/nextjs - next.js@11.0.1 - integrations"
      commands:
      - npm install next@11.0.1 react@17.0.2 react-dom@17.0.2 --save-dev
      - BUNDLE_GEMFILE=packages/nextjs/test/Gemfile bundle install
      - BUNDLE_GEMFILE=packages/nextjs/test/Gemfile bundle exec rspec packages/nextjs/test
    - name: "@appsignal/nextjs - next.js@10.2.3 - integrations"
      commands:
      - npm install next@10.2.3 react@16.14.0 react-dom@16.14.0 --save-dev
      - BUNDLE_GEMFILE=packages/nextjs/test/Gemfile bundle install
      - BUNDLE_GEMFILE=packages/nextjs/test/Gemfile bundle exec rspec packages/nextjs/test
- name: Node.js 12 - Build
  dependencies:
  - Validation
  task:
    env_vars:
    - name: NODE_VERSION
      value: '12'
    prologue:
      commands:
      - cache restore
      - mono bootstrap --ci
      - cache store
    jobs:
    - name: Build
      commands:
      - mono build
      - mono run --package @appsignal/nodejs-ext -- npm run build:ext
      - cache store $_PACKAGES_CACHE-packages-$SEMAPHORE_GIT_SHA-v$NODE_VERSION packages
      - cache store $_PACKAGES_CACHE-install-report-$SEMAPHORE_GIT_SHA-v$NODE_VERSION
        /tmp/appsignal-*-install.report
- name: Node.js 12 - Tests
  dependencies:
  - Node.js 12 - Build
  task:
    env_vars:
    - name: NODE_VERSION
      value: '12'
    prologue:
      commands:
      - cache restore
      - cache restore $_PACKAGES_CACHE-packages-$SEMAPHORE_GIT_SHA-v$NODE_VERSION
      - cache restore $_PACKAGES_CACHE-install-report-$SEMAPHORE_GIT_SHA-v$NODE_VERSION
      - mono bootstrap --ci
    jobs:
    - name: "@appsignal/nodejs - nodejs"
      commands:
      - mono test --package=@appsignal/nodejs
    - name: "@appsignal/nodejs - nodejs - diagnose"
      commands:
      - git submodule init
      - git submodule update
      - LANGUAGE=nodejs test/integration/diagnose/bin/test
    - name: "@appsignal/nodejs-ext - nodejs-ext"
      commands:
      - mono test --package=@appsignal/nodejs-ext
      - mono run --package @appsignal/nodejs-ext -- npm run test:failure
    - name: "@appsignal/apollo-server - apollo-server@latest"
      commands:
      - npm install apollo-server-plugin-base@latest --save-dev
      - mono test --package=@appsignal/apollo-server
    - name: "@appsignal/apollo-server - apollo-server@latest - integrations"
      commands:
      - npm install apollo-server-plugin-base@latest --save-dev
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle install
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle exec rspec packages/apollo-server/test
    - name: "@appsignal/apollo-server - apollo-server@0.13.0"
      commands:
      - npm install apollo-server-plugin-base@0.13.0 --save-dev
      - mono test --package=@appsignal/apollo-server
    - name: "@appsignal/apollo-server - apollo-server@0.13.0 - integrations"
      commands:
      - npm install apollo-server-plugin-base@0.13.0 --save-dev
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle install
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle exec rspec packages/apollo-server/test
    - name: "@appsignal/apollo-server - apollo-server@0.12.0"
      commands:
      - npm install apollo-server-plugin-base@0.12.0 --save-dev
      - mono test --package=@appsignal/apollo-server
    - name: "@appsignal/apollo-server - apollo-server@0.12.0 - integrations"
      commands:
      - npm install apollo-server-plugin-base@0.12.0 --save-dev
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle install
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle exec rspec packages/apollo-server/test
    - name: "@appsignal/apollo-server - apollo-server@0.11.0"
      commands:
      - npm install apollo-server-plugin-base@0.11.0 --save-dev
      - mono test --package=@appsignal/apollo-server
    - name: "@appsignal/apollo-server - apollo-server@0.11.0 - integrations"
      commands:
      - npm install apollo-server-plugin-base@0.11.0 --save-dev
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle install
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle exec rspec packages/apollo-server/test
    - name: "@appsignal/nextjs - next.js@latest - integrations"
      commands:
      - npm install next@latest react@latest react-dom@latest --save-dev
      - BUNDLE_GEMFILE=packages/nextjs/test/Gemfile bundle install
      - BUNDLE_GEMFILE=packages/nextjs/test/Gemfile bundle exec rspec packages/nextjs/test
    - name: "@appsignal/nextjs - next.js@11.0.1 - integrations"
      commands:
      - npm install next@11.0.1 react@17.0.2 react-dom@17.0.2 --save-dev
      - BUNDLE_GEMFILE=packages/nextjs/test/Gemfile bundle install
      - BUNDLE_GEMFILE=packages/nextjs/test/Gemfile bundle exec rspec packages/nextjs/test
    - name: "@appsignal/nextjs - next.js@10.2.3 - integrations"
      commands:
      - npm install next@10.2.3 react@16.14.0 react-dom@16.14.0 --save-dev
      - BUNDLE_GEMFILE=packages/nextjs/test/Gemfile bundle install
      - BUNDLE_GEMFILE=packages/nextjs/test/Gemfile bundle exec rspec packages/nextjs/test
- name: Node.js 11 - Build
  dependencies:
  - Validation
  task:
    env_vars:
    - name: NODE_VERSION
      value: '11'
    prologue:
      commands:
      - cache restore
      - mono bootstrap --ci
      - cache store
    jobs:
    - name: Build
      commands:
      - mono build
      - mono run --package @appsignal/nodejs-ext -- npm run build:ext
      - cache store $_PACKAGES_CACHE-packages-$SEMAPHORE_GIT_SHA-v$NODE_VERSION packages
      - cache store $_PACKAGES_CACHE-install-report-$SEMAPHORE_GIT_SHA-v$NODE_VERSION
        /tmp/appsignal-*-install.report
- name: Node.js 11 - Tests
  dependencies:
  - Node.js 11 - Build
  task:
    env_vars:
    - name: NODE_VERSION
      value: '11'
    prologue:
      commands:
      - cache restore
      - cache restore $_PACKAGES_CACHE-packages-$SEMAPHORE_GIT_SHA-v$NODE_VERSION
      - cache restore $_PACKAGES_CACHE-install-report-$SEMAPHORE_GIT_SHA-v$NODE_VERSION
      - mono bootstrap --ci
    jobs:
    - name: "@appsignal/nodejs - nodejs"
      commands:
      - mono test --package=@appsignal/nodejs
    - name: "@appsignal/nodejs - nodejs - diagnose"
      commands:
      - git submodule init
      - git submodule update
      - LANGUAGE=nodejs test/integration/diagnose/bin/test
    - name: "@appsignal/nodejs-ext - nodejs-ext"
      commands:
      - mono test --package=@appsignal/nodejs-ext
      - mono run --package @appsignal/nodejs-ext -- npm run test:failure
    - name: "@appsignal/apollo-server - apollo-server@latest"
      commands:
      - npm install apollo-server-plugin-base@latest --save-dev
      - mono test --package=@appsignal/apollo-server
    - name: "@appsignal/apollo-server - apollo-server@latest - integrations"
      commands:
      - npm install apollo-server-plugin-base@latest --save-dev
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle install
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle exec rspec packages/apollo-server/test
    - name: "@appsignal/apollo-server - apollo-server@0.13.0"
      commands:
      - npm install apollo-server-plugin-base@0.13.0 --save-dev
      - mono test --package=@appsignal/apollo-server
    - name: "@appsignal/apollo-server - apollo-server@0.13.0 - integrations"
      commands:
      - npm install apollo-server-plugin-base@0.13.0 --save-dev
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle install
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle exec rspec packages/apollo-server/test
    - name: "@appsignal/apollo-server - apollo-server@0.12.0"
      commands:
      - npm install apollo-server-plugin-base@0.12.0 --save-dev
      - mono test --package=@appsignal/apollo-server
    - name: "@appsignal/apollo-server - apollo-server@0.12.0 - integrations"
      commands:
      - npm install apollo-server-plugin-base@0.12.0 --save-dev
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle install
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle exec rspec packages/apollo-server/test
    - name: "@appsignal/apollo-server - apollo-server@0.11.0"
      commands:
      - npm install apollo-server-plugin-base@0.11.0 --save-dev
      - mono test --package=@appsignal/apollo-server
    - name: "@appsignal/apollo-server - apollo-server@0.11.0 - integrations"
      commands:
      - npm install apollo-server-plugin-base@0.11.0 --save-dev
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle install
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle exec rspec packages/apollo-server/test
    - name: "@appsignal/nextjs - next.js@latest - integrations"
      commands:
      - npm install next@latest react@latest react-dom@latest --save-dev
      - BUNDLE_GEMFILE=packages/nextjs/test/Gemfile bundle install
      - BUNDLE_GEMFILE=packages/nextjs/test/Gemfile bundle exec rspec packages/nextjs/test
    - name: "@appsignal/nextjs - next.js@11.0.1 - integrations"
      commands:
      - npm install next@11.0.1 react@17.0.2 react-dom@17.0.2 --save-dev
      - BUNDLE_GEMFILE=packages/nextjs/test/Gemfile bundle install
      - BUNDLE_GEMFILE=packages/nextjs/test/Gemfile bundle exec rspec packages/nextjs/test
    - name: "@appsignal/nextjs - next.js@10.2.3 - integrations"
      commands:
      - npm install next@10.2.3 react@16.14.0 react-dom@16.14.0 --save-dev
      - BUNDLE_GEMFILE=packages/nextjs/test/Gemfile bundle install
      - BUNDLE_GEMFILE=packages/nextjs/test/Gemfile bundle exec rspec packages/nextjs/test
- name: Node.js 10 - Build
  dependencies:
  - Validation
  task:
    env_vars:
    - name: NODE_VERSION
      value: '10'
    prologue:
      commands:
      - cache restore
      - mono bootstrap --ci
      - cache store
    jobs:
    - name: Build
      commands:
      - mono build
      - mono run --package @appsignal/nodejs-ext -- npm run build:ext
      - cache store $_PACKAGES_CACHE-packages-$SEMAPHORE_GIT_SHA-v$NODE_VERSION packages
      - cache store $_PACKAGES_CACHE-install-report-$SEMAPHORE_GIT_SHA-v$NODE_VERSION
        /tmp/appsignal-*-install.report
- name: Node.js 10 - Tests
  dependencies:
  - Node.js 10 - Build
  task:
    env_vars:
    - name: NODE_VERSION
      value: '10'
    prologue:
      commands:
      - cache restore
      - cache restore $_PACKAGES_CACHE-packages-$SEMAPHORE_GIT_SHA-v$NODE_VERSION
      - cache restore $_PACKAGES_CACHE-install-report-$SEMAPHORE_GIT_SHA-v$NODE_VERSION
      - mono bootstrap --ci
    jobs:
    - name: "@appsignal/nodejs - nodejs"
      commands:
      - mono test --package=@appsignal/nodejs
    - name: "@appsignal/nodejs - nodejs - diagnose"
      commands:
      - git submodule init
      - git submodule update
      - LANGUAGE=nodejs test/integration/diagnose/bin/test
    - name: "@appsignal/nodejs-ext - nodejs-ext"
      commands:
      - mono test --package=@appsignal/nodejs-ext
      - mono run --package @appsignal/nodejs-ext -- npm run test:failure
    - name: "@appsignal/apollo-server - apollo-server@latest"
      commands:
      - npm install apollo-server-plugin-base@latest --save-dev
      - mono test --package=@appsignal/apollo-server
    - name: "@appsignal/apollo-server - apollo-server@latest - integrations"
      commands:
      - npm install apollo-server-plugin-base@latest --save-dev
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle install
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle exec rspec packages/apollo-server/test
    - name: "@appsignal/apollo-server - apollo-server@0.13.0"
      commands:
      - npm install apollo-server-plugin-base@0.13.0 --save-dev
      - mono test --package=@appsignal/apollo-server
    - name: "@appsignal/apollo-server - apollo-server@0.13.0 - integrations"
      commands:
      - npm install apollo-server-plugin-base@0.13.0 --save-dev
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle install
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle exec rspec packages/apollo-server/test
    - name: "@appsignal/apollo-server - apollo-server@0.12.0"
      commands:
      - npm install apollo-server-plugin-base@0.12.0 --save-dev
      - mono test --package=@appsignal/apollo-server
    - name: "@appsignal/apollo-server - apollo-server@0.12.0 - integrations"
      commands:
      - npm install apollo-server-plugin-base@0.12.0 --save-dev
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle install
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle exec rspec packages/apollo-server/test
    - name: "@appsignal/apollo-server - apollo-server@0.11.0"
      commands:
      - npm install apollo-server-plugin-base@0.11.0 --save-dev
      - mono test --package=@appsignal/apollo-server
    - name: "@appsignal/apollo-server - apollo-server@0.11.0 - integrations"
      commands:
      - npm install apollo-server-plugin-base@0.11.0 --save-dev
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle install
      - BUNDLE_GEMFILE=packages/apollo-server/test/Gemfile bundle exec rspec packages/apollo-server/test
    - name: "@appsignal/nextjs - next.js@latest - integrations"
      commands:
      - npm install next@latest react@latest react-dom@latest --save-dev
      - BUNDLE_GEMFILE=packages/nextjs/test/Gemfile bundle install
      - BUNDLE_GEMFILE=packages/nextjs/test/Gemfile bundle exec rspec packages/nextjs/test
    - name: "@appsignal/nextjs - next.js@11.0.1 - integrations"
      commands:
      - npm install next@11.0.1 react@17.0.2 react-dom@17.0.2 --save-dev
      - BUNDLE_GEMFILE=packages/nextjs/test/Gemfile bundle install
      - BUNDLE_GEMFILE=packages/nextjs/test/Gemfile bundle exec rspec packages/nextjs/test
    - name: "@appsignal/nextjs - next.js@10.2.3 - integrations"
      commands:
      - npm install next@10.2.3 react@16.14.0 react-dom@16.14.0 --save-dev
      - BUNDLE_GEMFILE=packages/nextjs/test/Gemfile bundle install
      - BUNDLE_GEMFILE=packages/nextjs/test/Gemfile bundle exec rspec packages/nextjs/test
